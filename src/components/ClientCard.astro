---
import type { ClientCardInfoProps } from '@/sections/home/types/ClientsGrid.types';

interface Props {
  service: ClientCardInfoProps;
  index: number;
}

const { service, index } = Astro.props;
---

<div
  class="client-card group bg-card cursor-pointer overflow-hidden rounded-2xl border border-slate-700 p-6 transition-all duration-500 ease-in-out hover:border-slate-600"
  data-service-id={service.id}
  data-index={index}
  role="listitem"
>
  <!-- Header: Logo + Status Badge -->
  <div class="mb-4 flex items-start justify-between">
    <!-- Client Logo -->
    <div
      class="flex items-center justify-center rounded-lg bg-white p-2 transition-transform duration-300 group-hover:scale-110"
      aria-hidden="true"
    >
      {
        service.image ? (
          <img
            src={service.image}
            alt={`Logo de ${service.title}`}
            class="h-24 w-24 object-contain"
          />
        ) : (
          <div class="flex items-center justify-center bg-none py-6">
            <img
              src={service.image}
              alt={service.title}
              loading="lazy"
              class="h-40 w-40 transition"
            />
          </div>
        )
      }
    </div>

    <!-- Status Badge: "EXPLORAR" / "DETALLE" -->
    <span
      class="card-status text-foreground text-xs font-bold tracking-wider uppercase transition-colors duration-300"
      aria-live="polite"
    >
    </span>
  </div>

  <!-- Title -->
  <h3 class="text-foreground mb-2 text-xl font-bold transition-all duration-300">
    {service.title}
  </h3>

  <!-- Short Description (visible when collapsed) -->
  <p class="card-short-desc text-foreground text-sm transition-opacity duration-300">
    {service.shortDesc}
  </p>

  <!-- Full Content (visible when expanded) -->
  <div class="card-full-content mt-4 hidden space-y-4 opacity-0 transition-opacity duration-300">
    <p class="text-foreground leading-relaxed">{service.fullDesc}</p>

    <!-- Client Info Grid -->
    <div class="mt-4 space-y-4 border-t border-slate-700/50 pt-4">
      <div>
        <span class="text-foreground mb-1 block text-xs uppercase">Servicio Prestado</span>
        <p class="text=foreground text-sm font-medium">{service.serviceProvided}</p>
      </div>
      <div>
        <span class="text-foreground mb-1 block text-xs uppercase">Testimonio</span>
        <p class="text-foreground text-sm italic">{service.testimony}</p>
      </div>
    </div>
  </div>
</div>

<style is:global>
  /* ===== Card Base Styles ===== */
  .client-card {
    transition:
      grid-column 0.5s cubic-bezier(0.4, 0, 0.2, 1),
      grid-row 0.5s cubic-bezier(0.4, 0, 0.2, 1),
      background-color 0.5s cubic-bezier(0.4, 0, 0.2, 1),
      border-color 0.3s ease,
      transform 0.3s ease-in-out;
  }

  /* ===== Expanded State ===== */
  .client-card.expanded {
    grid-column: span 2;
    grid-row: span 2;
    border: 2px solid hsl(210 80% 55%) !important;
    color: white;
  }

  .client-card.expanded .card-status {
    color: hsl(0, 0%, 0%);
  }

  /* ===== Height Constraints ===== */
  .client-card {
    min-height: 200px;
  }

  .client-card.expanded {
    min-height: 400px;
  }

  /* ===== Content Visibility Transitions ===== */

  /* Short description: visible when collapsed */
  .client-card:not(.expanded) .card-short-desc {
    opacity: 1;
    transition: opacity 0.5s ease-in-out;
  }

  .client-card.expanded .card-short-desc {
    opacity: 0;
    height: 0;
    overflow: hidden;
    transition: opacity 0.5s ease-in-out;
  }

  /* Full content: hidden when collapsed */
  .client-card:not(.expanded) .card-full-content {
    opacity: 0;
    max-height: 0;
    overflow: hidden;
  }

  .client-card.expanded .card-full-content {
    display: block;
    opacity: 1;
    max-height: 1000px;
    transition:
      opacity 0.4s ease 0.1s,
      max-height 0.5s ease;
  }

  /* ===== Status Badge Text ===== */
  .client-card.expanded .card-status::before {
    content: 'Detalle';
  }

  .client-card:not(.expanded) .card-status::before {
    content: 'Explorar';
  }
</style>
