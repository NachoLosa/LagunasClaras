---
import Chevron from './Chevron.astro';

interface Props {
  href: string;
  text: string;
  class?: string;
  linkClass?: string;
  id?: string;
  position?: string;
}

const {
  href,
  text,
  class: className,
  linkClass = 'text-primary-foreground/70 hover:text-primary-foreground',
  id = 'scroll-indicator',
  position = '',
} = Astro.props;
---

<div
  class:list={['animate-fade-up', position, className]}
  style="--dur:0.9s; --delay:0.9s; --offset:8px"
>
  <a
    href={href}
    class:list={['flex flex-col items-center gap-2 transition-colors', linkClass]}
    aria-label="Scroll to next section"
    id={id}
  >
    <span class="text-sm font-medium">{text}</span>
    <Chevron direction="down" class="animate-bounce text-current" />
  </a>
</div>

<script is:inline define:vars={{ id }}>
  const scrollIndicator = document.getElementById(id);
  if (scrollIndicator) {
    scrollIndicator.addEventListener('click', (e) => {
      const href = scrollIndicator.getAttribute('href');
      if (href && href.startsWith('#')) {
        e.preventDefault();
        const target = document.querySelector(href);
        if (target) {
          const navbarHeight = 80; // Correspond to h-20 in navbar.astro
          const targetPosition =
            target.getBoundingClientRect().top + window.pageYOffset - navbarHeight;
          window.scrollTo({
            top: targetPosition,
            behavior: 'smooth',
          });
        }
      }
    });
  }
</script>

<style>
  @keyframes fade-up {
    from {
      opacity: 0;
      transform: translateY(var(--offset, 16px));
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }

  .animate-fade-up {
    animation-name: fade-up;
    animation-duration: var(--dur, 0.8s);
    animation-delay: var(--delay, 0s);
    animation-timing-function: cubic-bezier(0.22, 1, 0.36, 1);
    animation-fill-mode: both;
  }

  @media (prefers-reduced-motion: reduce) {
    .animate-fade-up {
      animation: none !important;
      opacity: 1 !important;
      transform: none !important;
    }
  }
</style>
